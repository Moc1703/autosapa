<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AutoSapa - WhatsApp Automation</title>
    <link rel="stylesheet" href="style.css">
    <!-- Ionicons for clean icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Script Logic -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="script.js"></script>
</head>
<body>

<div class="app-wrapper">
    <!-- 1. SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">üì°</div> 
            <span class="sidebar-title">AutoSapa</span>
        </div>
        
        <nav class="sidebar-nav">
            <div class="sidebar-item active" onclick="switchTab('dashboard')" data-tab="dashboard">
                <ion-icon name="home-outline"></ion-icon> Dashboard
            </div>
            <div class="sidebar-item" onclick="switchTab('broadcast')" data-tab="broadcast">
                <ion-icon name="megaphone-outline"></ion-icon> Broadcast
            </div>
            <div class="sidebar-item" onclick="switchTab('groups')" data-tab="groups">
                <ion-icon name="people-outline"></ion-icon> Groups
            </div>
            <div class="sidebar-item" onclick="switchTab('auto')" data-tab="auto">
                <ion-icon name="chatbubbles-outline"></ion-icon> Auto Reply
            </div>
            <div class="sidebar-item" onclick="switchTab('schedule')" data-tab="schedule">
                <ion-icon name="calendar-outline"></ion-icon> Schedule
            </div>
            <div class="sidebar-item" onclick="switchTab('history')" data-tab="history">
                <ion-icon name="stats-chart-outline"></ion-icon> Statistics
            </div>
            <div class="sidebar-item" onclick="switchTab('settings')" data-tab="settings">
                <ion-icon name="settings-outline"></ion-icon> Settings
            </div>
            <div class="sidebar-item" onclick="switchTab('changelog')" data-tab="changelog">
                <ion-icon name="gift-outline"></ion-icon> Changelog
            </div>
        </nav>
        
        <div class="sidebar-footer">
            <div style="font-size: 12px; color: var(--text-muted);">Status: <span id="statusTextDesktop">Connecting...</span></div>
        </div>
    </aside>
    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- 2. MAIN CONTENT -->
    <main class="app-main">
        <!-- Mobile Header -->
        <header class="app-header">
            <button class="btn-icon" onclick="toggleSidebar()" id="hamburgerBtn"><ion-icon name="menu-outline"></ion-icon></button>
            <div class="sidebar-title" style="font-size:18px;">AutoSapa</div>
            <div id="statusBadge" style="width:10px; height:10px; background:red; border-radius:50%;"></div>
        </header>

        <!-- TAB: DASHBOARD -->
        <div id="tab-dashboard" class="tab-panel active">
            <!-- Welcome Section -->
            <div class="dash-welcome">
                <div>
                    <h1 class="page-title">Welcome back! üëã</h1>
                    <p class="page-subtitle" id="currentDate">Loading date...</p>
                </div>
                <!-- Status Badge (Desktop/Tablet) -->
                <div class="dash-status-pill disconnected" id="dashStatusPill">
                    <span class="status-dot"></span>
                    <span id="dashStatusText">Connecting...</span>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid-4">
                <div class="stat-card">
                    <div class="stat-value" id="dashTotalGroups">0</div>
                    <div class="stat-label">Groups</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dashTotalSent">0</div>
                    <div class="stat-label">Sent Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dashScheduled">0</div>
                    <div class="stat-label">Scheduled</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dashAutoReplies">0</div>
                    <div class="stat-label">Auto Replies</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <h2 class="card-title mb-4">Quick Actions</h2>
            <div class="dash-quick-grid">
                <div class="dash-quick-btn" onclick="switchTab('broadcast')">
                    <ion-icon name="megaphone-outline" class="dash-quick-icon"></ion-icon>
                    <span>Broadcast</span>
                </div>
                <div class="dash-quick-btn" onclick="switchTab('groups'); showAddGroup()">
                    <ion-icon name="add-circle-outline" class="dash-quick-icon"></ion-icon>
                    <span>Add Group</span>
                </div>
                <div class="dash-quick-btn" onclick="switchTab('schedule'); showAddSchedule()">
                    <ion-icon name="calendar-outline" class="dash-quick-icon"></ion-icon>
                    <span>Schedule</span>
                </div>
                <div class="dash-quick-btn" onclick="switchTab('auto'); showAddReply()">
                    <ion-icon name="chatbubbles-outline" class="dash-quick-icon"></ion-icon>
                    <span>Auto Reply</span>
                </div>
            </div>
            
            <!-- Recent Activity Placeholder -->
             <div class="card mt-4" style="margin-top: 32px;">
                <div class="card-header">
                    <h3 class="card-title">Recent Activity</h3>
                    <button class="btn btn-sm btn-secondary" onclick="switchTab('history')">View All</button>
                </div>
                <div id="dashboardHistoryList" style="min-height: 100px; display:flex; align-items:center; justify-content:center; color:var(--text-muted);">
                    No recent activity
                </div>
            </div>
        </div>
        
        <!-- TAB: BROADCAST (Full Feature) -->
        <div id="tab-broadcast" class="tab-panel">
            <div class="page-header flex justify-between align-center mb-4">
                <h1 class="page-title">üì¢ Broadcast Message</h1>
            </div>

            <!-- Quick Actions Grid -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">‚ö° Quick Actions</h3>
                    <button class="btn btn-sm btn-primary" onclick="showAddQuickAction()">+ Add</button>
                </div>
                <div class="quick-actions-grid" id="quickActionsGrid">
                    <p class="text-muted text-center">No quick actions yet</p>
                </div>
            </div>

            <!-- Desktop: Two Column Layout -->
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:24px;">
                <!-- Left Column: Message & Image -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Message</h3>
                    </div>
                    <div class="flex gap-2 mb-4">
                        <button class="btn btn-sm btn-secondary" onclick="loadDraft()">üìÇ Load</button>
                        <button class="btn btn-sm btn-secondary" onclick="saveDraft()">üíæ Save</button>
                        <button class="btn btn-sm btn-secondary" onclick="showTemplateSelect()">üìù Templates</button>
                    </div>
                    <div class="form-group mb-4">
                        <textarea class="form-input" id="quickMessage" rows="5" placeholder="Type your message here..." oninput="saveDraftDebounced()"></textarea>
                        <small class="draft-indicator hidden" id="draftIndicator">üíæ Draft saved</small>
                    </div>
                    <!-- Message Preview -->
                    <div id="messagePreview" class="hidden mb-2"></div>
                    <button class="btn btn-sm btn-secondary mb-4" onclick="previewMessage()">üëÅÔ∏è Preview</button>

                    <!-- Spintax Tutorial -->
                    <div class="card mb-4" style="background:linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,210,255,0.05)); border-color:rgba(0,255,136,0.3);">
                        <div onclick="toggleSpintaxTutorial()" style="display:flex; justify-content:space-between; align-items:center; cursor:pointer;">
                            <span style="font-weight:600; color:var(--primary); font-size:13px;">üé≤ Spintax Tutorial (Variasi Pesan)</span>
                            <span id="spintaxToggleIcon" style="color:var(--text-muted); transition:transform 0.2s;">‚ñº</span>
                        </div>
                        <div id="spintaxContent" class="hidden" style="margin-top:12px; font-size:12px; color:var(--text-main);">
                            <p style="margin-bottom:8px; color:var(--text-muted);">Gunakan spintax untuk membuat variasi pesan.</p>
                            <code style="color:#fbbf24; background:rgba(0,0,0,0.3); padding:4px 8px; border-radius:6px; display:block; margin-bottom:8px;">{opsi1|opsi2|opsi3}</code>
                            <p style="color:var(--text-muted); font-size:11px;">Contoh: {Halo|Hai|Hello} {kak|bro}! {üéâ|üî•}</p>
                        </div>
                    </div>

                    <div class="upload-area mb-4" id="uploadArea" onclick="document.getElementById('imageInput').click()" style="border:2px dashed var(--glass-border); border-radius:12px; padding:20px; text-align:center; cursor:pointer;">
                        <input type="file" id="imageInput" accept="image/*" style="display:none" onchange="previewImage(event)">
                        <span id="uploadText">üì∑ Click to add image (optional)</span>
                    </div>
                    <img id="imagePreview" class="image-preview hidden" style="max-width:100%; border-radius:12px; margin-bottom:12px;">
                    <button id="removeImageBtn" class="btn btn-sm btn-danger hidden" onclick="removeImage()">üóëÔ∏è Remove Image</button>

                    <!-- Media Library -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">üñºÔ∏è Media Library</h3>
                            <button class="btn btn-sm btn-secondary" onclick="loadMedia()">üîÑ Refresh</button>
                        </div>
                        <div class="media-grid" id="mediaGrid">
                            <p class="text-muted text-center">No images uploaded</p>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Group Selection & Settings -->
                <div>
                    <div class="card mb-4">
                        <div class="card-header" style="border-bottom:none;">
                            <h3 class="card-title">Target Recipients</h3>
                            <span class="selected-count" id="selectedCount">0 selected</span>
                        </div>
                        <div class="flex gap-2 mb-4" style="background:rgba(0,0,0,0.3); padding:4px; border-radius:12px;">
                            <button class="btn btn-sm btn-primary" onclick="switchTargetTab('groups')" id="tabBtn-groups" style="flex:1;">üë• Groups</button>
                            <button class="btn btn-sm btn-secondary" onclick="switchTargetTab('manual')" id="tabBtn-manual" style="flex:1;">üìù Manual</button>
                        </div>

                        <!-- Group Selection Panel -->
                        <div id="targetPanel-groups">
                            <div class="flex align-center gap-2 mb-2">
                                <input type="checkbox" id="selectAllGroups" onchange="toggleSelectAll()">
                                <label for="selectAllGroups">Select All</label>
                            </div>
                            <div class="group-select-list" id="groupSelectList" style="max-height:200px; overflow-y:auto; background:rgba(0,0,0,0.2); border-radius:8px; padding:8px; border:1px solid var(--glass-border);">
                                <div class="empty-state">
                                    <p class="text-muted">No groups yet. Add groups first.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Manual Input Panel -->
                        <div id="targetPanel-manual" class="hidden">
                            <textarea class="form-input" id="manualNumbers" placeholder="Paste WhatsApp numbers here...&#10;08123456789&#10;628123456789" style="min-height:200px; font-family:monospace"></textarea>
                            <p class="form-hint">Auto-formatted to Indonesia (+62). <span id="manualCount" class="badge badge-info">0 numbers</span></p>
                        </div>
                    </div>

                    <!-- Anti-Ban Settings -->
                    <div class="card mb-4">
                        <div class="card-header" onclick="toggleAntiBanSettings()" style="cursor:pointer;">
                            <h3 class="card-title">üõ°Ô∏è Anti-Ban Settings</h3>
                            <span id="antiBanIndicator" class="badge" style="background:var(--primary); color:#000;">Safe Mode ON</span>
                        </div>

                        <div id="antiBanSettings" class="hidden" style="margin-top:16px; border-top:1px solid var(--glass-border); padding-top:16px;">
                            <!-- Safe Mode Toggle -->
                            <div class="flex justify-between align-center mb-4">
                                <div>
                                    <span style="font-weight:600;">üîí Safe Mode</span>
                                    <p class="form-hint mb-0">Recommended to prevent banning.</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="safeModeToggle" checked onchange="toggleSafeMode()">
                                    <span class="slider round"></span>
                                </label>
                            </div>

                            <!-- Custom Settings -->
                            <div id="customAntiBanSettings" class="hidden">
                                <div class="form-group mb-4">
                                    <label class="form-label">Random Delay (seconds)</label>
                                    <div class="flex gap-2 align-center">
                                        <input type="number" class="form-input" id="delayMin" placeholder="Min" value="5" style="width:80px;">
                                        <span>-</span>
                                        <input type="number" class="form-input" id="delayMax" placeholder="Max" value="15" style="width:80px;">
                                    </div>
                                </div>

                                <!-- Sleep Mode -->
                                <div class="flex justify-between align-center mb-2">
                                    <div>
                                        <span style="font-weight:600;">üò¥ Sleep Mode</span>
                                        <p class="form-hint mb-0">Pause after sending X messages</p>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="sleepModeToggle" onchange="toggleSleepMode()">
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                                <div id="sleepSettings" class="hidden">
                                    <div class="flex gap-2 align-center">
                                        <span>After</span>
                                        <input type="number" class="form-input" id="sleepAfter" value="50" style="width:80px;">
                                        <span>msgs, sleep for</span>
                                        <input type="number" class="form-input" id="sleepDuration" value="5" style="width:80px;">
                                        <span>mins</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-2">
                        <button class="btn btn-primary btn-lg" onclick="sendBroadcast()" id="sendBtn" style="flex:1;">
                            üì§ Send Now
                        </button>
                        <button class="btn btn-secondary btn-lg" onclick="quickSchedule()" id="scheduleBtn" title="Schedule">
                            üìÖ
                        </button>
                    </div>
                    <p class="text-muted text-center mt-2" style="font-size:12px;">Press <kbd>Ctrl</kbd>+<kbd>Enter</kbd> to send</p>

                    <!-- Result -->
                    <div class="hidden mt-4" id="resultSection">
                        <div class="card" id="resultCard" style="border-color:var(--primary);">
                            <div class="result-icon text-center" style="font-size:48px;">‚úÖ</div>
                            <div class="result-title text-center" id="resultTitle" style="font-size:18px; font-weight:600; margin-bottom:16px;">Broadcast Sent!</div>
                            <div class="stats-grid-4" style="grid-template-columns: 1fr 1fr;">
                                <div class="stat-card">
                                    <div class="stat-value text-success" id="resultSuccess">0</div>
                                    <div class="stat-label">Success</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value text-danger" id="resultFailed">0</div>
                                    <div class="stat-label">Failed</div>
                                </div>
                            </div>
                            <div id="broadcastProgress" class="hidden text-center mt-2">
                                <p class="text-muted" id="progressText">Sending...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: GROUPS (Full Feature) -->
        <div id="tab-groups" class="tab-panel">
            <div class="page-header flex justify-between align-center mb-4">
                <h1 class="page-title">üë• Groups & Contacts</h1>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:24px;">
                <!-- Left: Groups -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">My Groups</h3>
                        <div class="flex gap-2">
                            <button class="btn btn-sm btn-secondary" onclick="toggleBulkMode()">‚òëÔ∏è Bulk</button>
                            <button class="btn btn-sm btn-primary" onclick="showAddGroup()">+ Add</button>
                        </div>
                    </div>

                    <!-- Bulk Actions Bar -->
                    <div id="bulkActions" class="hidden mb-2" style="background:rgba(0,255,136,0.1); padding:8px 12px; border-radius:8px; display:flex; justify-content:space-between; align-items:center;">
                        <span id="bulkCount">0 selected</span>
                        <button class="btn btn-sm btn-danger" onclick="bulkDeleteGroups()">üóëÔ∏è Delete Selected</button>
                    </div>

                    <!-- Category Filter Chips -->
                    <div class="category-chips mb-2" id="categoryChips" style="display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn btn-sm btn-primary" onclick="filterByCategory('all')">üìã All</button>
                    </div>

                    <div class="form-group mb-4">
                        <input type="text" class="form-input" id="searchGroups" placeholder="Search groups..." oninput="filterGroups()">
                    </div>
                    
                    <div class="flex gap-2 mb-4">
                        <button class="btn btn-secondary" onclick="discoverGroups()">üîç Discover</button>
                        <button class="btn btn-secondary" id="syncBtn" onclick="syncGroups()">üîÑ Sync</button>
                        <button class="btn btn-secondary" onclick="exportGroups()" title="Export">üì§</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importGroupsFile').click()" title="Import">üì•</button>
                        <input type="file" id="importGroupsFile" accept=".json" style="display:none" onchange="importGroups(event)">
                    </div>
                    
                    <div class="list" id="groupsList">
                        <div class="empty-state" id="groupsEmptyState" style="text-align:center; padding:40px;">
                            <div class="empty-icon" style="font-size:48px; margin-bottom:16px;">üë•</div>
                            <div class="empty-title" style="font-weight:600; margin-bottom:8px;">No groups yet</div>
                            <p class="text-muted mb-4">Choose how to add your WhatsApp groups:</p>
                            <div style="display:flex; flex-direction:column; gap:8px;">
                                <button class="btn btn-primary" onclick="syncGroups()" id="emptySyncBtn">üîÑ Sync All Groups</button>
                                <button class="btn btn-secondary" onclick="discoverGroups()">üîç Discover Groups</button>
                                <button class="btn btn-secondary" onclick="showAddGroup()">‚úèÔ∏è Add Manually</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right: Contacts -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìá Contacts</h3>
                        <button class="btn btn-sm btn-primary" onclick="showAddContact()">+ Add</button>
                    </div>
                    <div class="form-group mb-4">
                        <input type="text" class="form-input" id="searchContacts" placeholder="Search contacts..." oninput="filterContacts()">
                    </div>
                    <div class="list" id="contactsList">
                        <div class="empty-state" style="text-align:center; padding:40px;">
                            <p class="text-muted">Save contacts for quick access</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: AUTO REPLY (Full Feature) -->
        <div id="tab-auto" class="tab-panel">
            <div class="page-header flex justify-between align-center mb-4">
                <h1 class="page-title">ü§ñ Automation</h1>
            </div>

            <!-- Auto Reply Stats -->
            <div class="stats-grid-4 mb-4" id="autoReplyStats" style="grid-template-columns: 1fr 1fr;">
                <div class="stat-card">
                    <span class="stat-value">0</span>
                    <span class="stat-label">Total Triggers</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value">0</span>
                    <span class="stat-label">Today</span>
                </div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:24px;">
                <!-- Left: Auto Reply -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Auto Reply</h3>
                        <button class="btn btn-sm btn-primary" onclick="showAddReply()">+ Add</button>
                    </div>
                    <div class="list" id="autoReplyList">
                        <div class="empty-state" style="text-align:center; padding:40px;">
                            <div class="empty-icon" style="font-size:48px; margin-bottom:16px;">ü§ñ</div>
                            <div class="empty-title" style="font-weight:600; margin-bottom:8px;">No auto replies</div>
                            <p class="text-muted">Create automatic responses to keywords</p>
                        </div>
                    </div>
                </div>

                <!-- Right: Commands -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">‚ö° Commands</h3>
                        <button class="btn btn-sm btn-primary" onclick="showAddCommand()">+ Add</button>
                    </div>
                    <div class="form-group mb-4">
                        <input type="text" class="form-input" id="searchCommands" placeholder="Search commands..." oninput="filterCommands()">
                    </div>
                    <div class="list" id="commandsList">
                        <div class="empty-state" style="text-align:center; padding:40px;">
                            <p class="text-muted">Create !help, !menu, etc.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: SCHEDULE (Full Feature) -->
        <div id="tab-schedule" class="tab-panel">
            <!-- Header -->
            <div class="flex justify-between align-center mb-4">
                <div>
                    <h1 class="page-title">Schedule</h1>
                    <p class="page-subtitle text-muted">Manage scheduled broadcasts and templates</p>
                </div>
                <button class="btn btn-primary" onclick="showAddSchedule()">+ New Schedule</button>
            </div>

            <!-- Stats Row -->
            <div class="stats-grid-4 mb-4" style="grid-template-columns: 1fr 1fr 1fr;">
                <div class="stat-card">
                    <span class="stat-value" id="schedPending">0</span>
                    <span class="stat-label">Pending</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="schedSentToday">0</span>
                    <span class="stat-label">Sent Today</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="schedTotal">0</span>
                    <span class="stat-label">Total</span>
                </div>
            </div>

            <!-- Tabs: Schedules / Templates -->
            <div class="flex gap-2 mb-4" style="background:rgba(0,0,0,0.3); padding:4px; border-radius:12px; width:fit-content;">
                <button class="btn btn-sm btn-primary" onclick="switchScheduleTab('schedules')" id="tabSchedules">Schedules</button>
                <button class="btn btn-sm btn-secondary" onclick="switchScheduleTab('templates')" id="tabTemplates">Templates</button>
            </div>

            <!-- Schedules Panel -->
            <div class="schedule-panel" id="panelSchedules">
                <div class="flex gap-2 mb-4">
                    <input type="text" class="form-input" id="searchSchedules" placeholder="Search schedules..." oninput="filterSchedules()" style="flex:1;">
                    <div class="flex gap-2">
                        <button class="btn btn-sm btn-secondary" onclick="filterScheduleStatus('all')">All</button>
                        <button class="btn btn-sm btn-secondary" onclick="filterScheduleStatus('pending')">Pending</button>
                        <button class="btn btn-sm btn-secondary" onclick="filterScheduleStatus('sent')">Sent</button>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-secondary" onclick="exportSchedules()" title="Export">üì§</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importScheduleFile').click()" title="Import">üì•</button>
                        <input type="file" id="importScheduleFile" accept=".json" style="display:none" onchange="importSchedules(event)">
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-secondary" onclick="switchScheduleView('list')" id="viewListBtn" title="List View">üìã</button>
                        <button class="btn btn-secondary" onclick="switchScheduleView('calendar')" id="viewCalendarBtn" title="Calendar View">üìÖ</button>
                    </div>
                </div>

                <!-- List View -->
                <div class="card" id="scheduleList">
                    <div class="empty-state" style="text-align:center; padding:40px;">
                        <div class="empty-icon" style="font-size:48px; margin-bottom:16px;">üìÖ</div>
                        <div class="empty-title" style="font-weight:600; margin-bottom:8px;">No schedules yet</div>
                        <p class="text-muted">Create your first scheduled broadcast</p>
                        <button class="btn btn-primary mt-4" onclick="showAddSchedule()">+ Create Schedule</button>
                    </div>
                </div>

                <!-- Calendar View -->
                <div class="card hidden" id="scheduleCalendar">
                    <div class="flex justify-between align-center mb-4">
                        <button class="btn btn-sm btn-secondary" onclick="navigateCalendar(-1)">‚Üê</button>
                        <span class="calendar-month-title" id="calendarMonthTitle" style="font-weight:600; font-size:16px;">December 2025</span>
                        <button class="btn btn-sm btn-secondary" onclick="navigateCalendar(1)">‚Üí</button>
                    </div>
                    <div class="calendar-weekdays" style="display:grid; grid-template-columns: repeat(7, 1fr); text-align:center; margin-bottom:8px; color:var(--text-muted);">
                        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:4px;">
                        <!-- Days will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Templates Panel -->
            <div class="schedule-panel hidden" id="panelTemplates">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Saved Templates</h3>
                        <button class="btn btn-sm btn-primary" onclick="showAddTemplate()">+ Add Template</button>
                    </div>
                    <div class="list" id="templatesList">
                        <div class="empty-state" style="text-align:center; padding:40px;">
                            <p class="text-muted">No templates saved yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: STATISTICS (Full Feature) -->
        <div id="tab-history" class="tab-panel">
            <div class="page-header flex justify-between align-center mb-4">
                <h1 class="page-title">üìä Statistics</h1>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid-4 mb-4">
                <div class="stat-card">
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">Total Sent</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statSuccess">0%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statGroups">0</div>
                    <div class="stat-label">Groups</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statReplies">0</div>
                    <div class="stat-label">Auto Replies</div>
                </div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:24px;">
                <!-- Left: Weekly Activity Chart -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìà Weekly Activity</h3>
                        <button class="btn btn-sm btn-secondary" onclick="loadAnalytics()">üîÑ Refresh</button>
                    </div>
                    <div class="analytics-chart" id="analyticsChart" style="min-height:200px;">
                        <p class="text-muted text-center">Loading chart...</p>
                    </div>
                </div>

                <!-- Right: Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                        <div class="flex gap-2">
                            <button class="btn btn-sm btn-secondary" onclick="exportCSV()">üì• Export CSV</button>
                            <button class="btn btn-sm btn-danger" onclick="clearHistory()">üóëÔ∏è Clear</button>
                        </div>
                    </div>
                    <div class="list" id="historyList" style="max-height:300px; overflow-y:auto;">
                        <div class="empty-state" style="text-align:center; padding:40px;">
                            <p class="text-muted">No broadcast history yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: SETTINGS (Full Feature) -->
        <div id="tab-settings" class="tab-panel">
            <h1 class="page-title mb-4">‚öôÔ∏è Settings</h1>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:24px;">
                <!-- Left Column -->
                <div>
                    <div class="card mb-4">
                        <h3 class="card-title mb-4">üîå Connection</h3>
                        <div class="form-group mb-4">
                            <label class="form-label mb-2" style="display:block;">API Endpoint</label>
                            <input type="text" id="endpoint" class="form-input" value="http://localhost:3000">
                        </div>
                        <div class="form-group mb-4">
                            <label class="form-label mb-2" style="display:block;">API Key</label>
                            <input type="password" id="apiKey" class="form-input" value="*******">
                        </div>
                        <div class="form-group mb-4">
                            <label class="form-label mb-2" style="display:block;">Webhook URL</label>
                            <input type="text" id="webhookUrl" class="form-input" placeholder="https://your-domain.com/webhook">
                        </div>
                        <button class="btn btn-primary" onclick="saveSettings()">Save Configuration</button>
                    </div>

                    <div class="card mb-4">
                        <h3 class="card-title mb-4">üõ°Ô∏è Anti-Ban Settings</h3>
                        <div class="flex justify-between align-center mb-4">
                            <div>
                                <span style="font-weight:600;">Anti-Ban Queue</span>
                                <p class="form-hint mb-0">Add delay between messages</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="queueToggle" onchange="toggleSetting('queue')">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="flex justify-between align-center mb-4">
                            <div>
                                <span style="font-weight:600;">Typing Indicator</span>
                                <p class="form-hint mb-0">Show typing... before sending</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="typingToggle" onchange="toggleSetting('typing')">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="flex justify-between align-center">
                            <div>
                                <span style="font-weight:600;">Login Protection</span>
                                <p class="form-hint mb-0">Require password to access</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="authToggle" onchange="toggleSetting('auth')">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h3 class="card-title">üö´ Blacklist</h3>
                            <button class="btn btn-sm btn-secondary" onclick="showBlacklist()">Manage</button>
                        </div>
                        <div class="form-group mb-2">
                            <input type="text" class="form-input" id="blacklistInput" placeholder="Enter number to block (62812xxx)">
                        </div>
                        <button class="btn btn-danger btn-block" onclick="addBlacklist()">üö´ Block Number</button>
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <div class="card mb-4">
                        <h3 class="card-title mb-4">üíæ Backup & Data</h3>
                        <p class="text-muted mb-4">Download or restore all your data</p>
                        <div class="flex gap-2">
                            <button class="btn btn-secondary" onclick="downloadBackup()">üì• Backup</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('restoreFile').click()">üì§ Restore</button>
                            <input type="file" id="restoreFile" accept=".json" style="display:none" onchange="restoreBackup(event)">
                        </div>
                    </div>

                    <div class="card mb-4">
                        <h3 class="card-title mb-4">üìã Message Logs</h3>
                        <button class="btn btn-secondary btn-block" onclick="viewLogs()">View Incoming Messages</button>
                    </div>

                    <div class="card mb-4">
                        <h3 class="card-title mb-4">üì± WhatsApp</h3>
                        <p class="text-muted mb-4">Disconnect and link to another WhatsApp account</p>
                        <button class="btn btn-warning btn-block" onclick="switchWhatsApp()">üîÑ Switch WhatsApp Account</button>
                    </div>

                    <div class="card">
                        <h3 class="card-title mb-4">üö™ Session</h3>
                        <button class="btn btn-danger btn-block" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: CHANGELOG -->
        <div id="tab-changelog" class="tab-panel">
             <h1 class="page-title mb-4">Changelog</h1>
             <div class="card">
                 <ul style="list-style:none; padding-left:20px; border-left:2px solid var(--glass-border);">
                     <li style="margin-bottom:20px; position:relative;">
                         <span style="position:absolute; left:-26px; top:0; width:10px; height:10px; border-radius:50%; background:var(--primary); box-shadow:0 0 10px var(--primary);"></span>
                         <h3 style="margin-bottom:4px;">v2.0.0 - Reborn</h3>
                         <p style="color:var(--text-muted);">Complete UI Redesign with Glassmorphism, Dark Mode, and Responsive Drawer.</p>
                     </li>
                     <li style="margin-bottom:20px; position:relative;">
                         <span style="position:absolute; left:-26px; top:0; width:10px; height:10px; border-radius:50%; background:#555;"></span>
                         <h3 style="margin-bottom:4px;">v1.5.0</h3>
                         <p style="color:var(--text-muted);">Added Auto Reply and Schedule features.</p>
                     </li>
                 </ul>
             </div>
        </div>
    </main>

    <!-- MODALS -->
    <!-- Add Group Modal -->
    <div id="addGroupModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header flex justify-between align-center mb-4">
                <h3 class="card-title">Add Group Manually</h3>
                <button class="btn btn-sm btn-secondary" onclick="closeModal('addGroupModal')">√ó</button>
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Group Name</label>
                <input type="text" class="form-input" id="groupNameInput" placeholder="My Group">
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Group ID</label>
                <input type="text" class="form-input" id="groupIdInput" placeholder="6281234567890-1234567890@g.us">
            </div>
            <div style="background:rgba(0,255,136,0.1); border:1px solid rgba(0,255,136,0.3); border-radius:12px; padding:12px; margin-bottom:16px;">
                <p style="font-weight:600; color:var(--primary); margin-bottom:8px;">üìã How to get Group ID:</p>
                <ol style="font-size:13px; color:var(--text-muted); padding-left:20px; margin:0;">
                    <li style="margin-bottom:4px;">Open WhatsApp Web on your browser</li>
                    <li style="margin-bottom:4px;">Open the group chat you want to add</li>
                    <li style="margin-bottom:4px;">Click the group name at top ‚Üí Scroll down</li>
                    <li>Use <strong>Discover Groups</strong> button for easier way</li>
                </ol>
                <p style="font-size:12px; color:var(--text-muted); margin-top:8px; margin-bottom:0;">üí° Tip: Use "Sync Groups" to auto-import all your groups</p>
            </div>
            <button class="btn btn-primary btn-block" onclick="saveGroup()">Save Group</button>
        </div>
    </div>
    <!-- Add Schedule Modal -->
    <div id="addScheduleModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header flex justify-between align-center mb-4">
                <h3 class="card-title">Schedule Broadcast</h3>
                <button class="btn btn-sm btn-secondary" onclick="closeModal('addScheduleModal')">√ó</button>
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Schedule Name</label>
                <input type="text" class="form-input" id="scheduleName" placeholder="e.g., Morning Greeting, Weekly Promo">
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Select Groups</label>
                <div style="max-height:150px; overflow-y:auto; border:1px solid var(--glass-border); border-radius:8px; padding:8px; background:rgba(0,0,0,0.2);">
                    <label class="flex align-center gap-2" style="padding:8px; border-bottom:1px solid var(--glass-border); margin-bottom:4px;">
                        <input type="checkbox" id="scheduleSelectAll" onchange="toggleScheduleSelectAll()">
                        <span style="font-weight:600;">Select All</span>
                    </label>
                    <div id="scheduleGroupList"></div>
                </div>
                <small class="text-muted" id="scheduleSelectedCount">0 groups selected</small>
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Message</label>
                <textarea class="form-input" id="scheduleMessage" rows="4" placeholder="Your scheduled message..."></textarea>
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Image (optional)</label>
                <div class="upload-area" onclick="document.getElementById('scheduleImageInput').click()" style="border:2px dashed var(--glass-border); border-radius:12px; padding:16px; text-align:center; cursor:pointer;">
                    <input type="file" id="scheduleImageInput" accept="image/*" style="display:none" onchange="previewScheduleImage(event)">
                    <span id="scheduleUploadText">üì∑ Click to add image</span>
                </div>
                <img id="scheduleImagePreview" class="image-preview hidden" style="max-width:100%; border-radius:12px; margin-top:8px;">
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Date & Time</label>
                <input type="datetime-local" class="form-input" id="scheduleTime">
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Repeat</label>
                <select class="form-input" id="scheduleRepeat">
                    <option value="">One time only</option>
                    <option value="daily">Every day</option>
                    <option value="weekly">Every week</option>
                    <option value="monthly">Every month</option>
                </select>
            </div>
            <button class="btn btn-primary btn-block" onclick="saveSchedule()">Schedule</button>
        </div>
    </div>
</div>

    <!-- Add Auto Reply Modal -->
    <div id="addReplyModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header flex justify-between align-center mb-4">
                <h3 class="card-title">Add Auto Reply</h3>
                <button class="btn btn-sm btn-secondary" onclick="closeModal('addReplyModal')">√ó</button>
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Keyword</label>
                <input type="text" class="form-input" id="replyKeyword" placeholder="e.g., info, help">
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Match Type</label>
                <select class="form-input" id="replyMatchType">
                    <option value="contains">Contains (phrase in order)</option>
                    <option value="exact">Exact Match</option>
                    <option value="startswith">Starts With</option>
                    <option value="words">All Words (any order)</option>
                    <option value="anyword">Any Word (at least one)</option>
                </select>
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Response</label>
                <textarea class="form-input" id="replyResponse" rows="4" placeholder="Your automatic response..."></textarea>
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Image (optional)</label>
                <div class="upload-area" onclick="document.getElementById('replyImageInput').click()" style="border:2px dashed var(--glass-border); border-radius:12px; padding:16px; text-align:center; cursor:pointer;">
                    <input type="file" id="replyImageInput" accept="image/*" style="display:none" onchange="previewReplyImage(event)">
                    <span id="replyUploadText">üì∑ Click to add image</span>
                </div>
                <img id="replyImagePreview" class="image-preview hidden" style="max-width:100%; border-radius:12px; margin-top:8px;">
            </div>
            <button class="btn btn-primary btn-block" onclick="saveAutoReply()">Save Auto Reply</button>
        </div>
    </div>

    <!-- Add Contact Modal -->
    <div id="addContactModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header flex justify-between align-center mb-4">
                <h3 class="card-title">Add Contact</h3>
                <button class="btn btn-sm btn-secondary" onclick="closeModal('addContactModal')">√ó</button>
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Name</label>
                <input type="text" class="form-input" id="contactName" placeholder="John Doe">
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Phone Number</label>
                <input type="text" class="form-input" id="contactNumber" placeholder="628123456789">
            </div>
            <button class="btn btn-primary btn-block" onclick="saveContact()">Save Contact</button>
        </div>
    </div>

    <!-- Add Template Modal -->
    <div id="addTemplateModal" class="modal hidden">
        <div class="modal-content">
            <h2 class="card-title mb-4">Save Template</h2>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Template Name</label>
                <input type="text" class="form-input" id="templateName" placeholder="e.g., Job Vacancy">
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Message</label>
                <textarea class="form-input" id="templateMessage" rows="6" placeholder="Your template message..."></textarea>
            </div>
            <p class="form-hint mb-4">Variables: {date}, {time}, {day}, {month}, {year}</p>
            <div class="flex justify-end gap-2">
                <button class="btn btn-secondary" onclick="closeModal('addTemplateModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveTemplate()">Save Template</button>
            </div>
        </div>
    </div>

    <!-- Add Command Modal -->
    <div id="addCommandModal" class="modal hidden">
        <div class="modal-content">
            <h2 class="card-title mb-4">Add Command</h2>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Command</label>
                <input type="text" class="form-input" id="commandName" placeholder="!help">
                <p class="form-hint">Must start with !</p>
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Response</label>
                <textarea class="form-input" id="commandResponse" rows="4" placeholder="Response when command is called..."></textarea>
            </div>
            <div class="flex justify-end gap-2">
                <button class="btn btn-secondary" onclick="closeModal('addCommandModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveCommand()">Save Command</button>
            </div>
        </div>
    </div>

    <!-- Discover Modal -->
    <div id="discoverModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between align-center mb-4">
                <h2 class="card-title">Discovered Groups</h2>
                <button class="btn btn-sm btn-secondary" onclick="closeModal('discoverModal')">√ó</button>
            </div>
            <div id="discoveredList" style="max-height:400px; overflow-y:auto;">
                <div class="loading text-center" style="padding:40px;">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Select Modal -->
    <div id="templateSelectModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between align-center mb-4">
                <h2 class="card-title">Select Template</h2>
                <button class="btn btn-sm btn-secondary" onclick="closeModal('templateSelectModal')">√ó</button>
            </div>
            <div id="templateSelectList" style="max-height:400px; overflow-y:auto;">
                <div class="empty-state" style="text-align:center; padding:40px;">
                    <p class="text-muted">No templates saved yet</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Logs Modal -->
    <div id="logsModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between align-center mb-4">
                <h2 class="card-title">Message Logs</h2>
                <button class="btn btn-sm btn-secondary" onclick="closeModal('logsModal')">√ó</button>
            </div>
            <div id="logsContent" style="max-height:400px; overflow-y:auto; font-family:monospace; font-size:12px;"></div>
            <button class="btn btn-danger btn-block mt-4" onclick="clearMessageLogs()">üóëÔ∏è Clear All Logs</button>
        </div>
    </div>

    <!-- Blacklist Modal -->
    <div id="blacklistModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between align-center mb-4">
                <h2 class="card-title">Blocked Numbers</h2>
                <button class="btn btn-sm btn-secondary" onclick="closeModal('blacklistModal')">√ó</button>
            </div>
            <div id="blacklistContent" style="max-height:400px; overflow-y:auto;"></div>
        </div>
    </div>

    <!-- Members Modal -->
    <div id="membersModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between align-center mb-4">
                <h2 class="card-title">Group Members</h2>
                <button class="btn btn-sm btn-secondary" onclick="closeModal('membersModal')">√ó</button>
            </div>
            <div id="membersList" style="max-height:400px; overflow-y:auto;"></div>
        </div>
    </div>

    <!-- Add Quick Action Modal -->
    <div id="addQuickActionModal" class="modal hidden">
        <div class="modal-content">
            <h2 class="card-title mb-4">Add Quick Action</h2>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Action Name</label>
                <input type="text" class="form-input" id="quickActionName" placeholder="e.g., Morning Greeting">
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Icon (emoji)</label>
                <input type="text" class="form-input" id="quickActionIcon" placeholder="‚ö°" maxlength="2">
            </div>
            <div class="form-group mb-4">
                <label class="form-label mb-2" style="display:block;">Message</label>
                <textarea class="form-input" id="quickActionMessage" rows="4" placeholder="Message to send..."></textarea>
            </div>
            <p class="form-hint mb-4">Uses groups selected in Broadcast tab</p>
            <div class="flex justify-end gap-2">
                <button class="btn btn-secondary" onclick="closeModal('addQuickActionModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveQuickAction()">Save Quick Action</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal hidden">
        <div class="modal-content" style="max-width:400px;">
            <h2 class="card-title mb-4">Confirm</h2>
            <p id="confirmMessage" style="margin-bottom:20px; color:var(--text-muted);"></p>
            <div class="flex justify-end gap-2">
                <button class="btn btn-secondary" id="confirmNo">Cancel</button>
                <button class="btn btn-danger" id="confirmYes">Delete</button>
            </div>
        </div>
    </div>

</div>

<!-- Offline Indicator -->
<div id="offlineIndicator" class="offline-indicator hidden" style="position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(239,68,68,0.9); color:white; padding:12px 24px; border-radius:12px; z-index:1000;">
    <span>üì° You are offline</span>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="toast-container" style="position:fixed; top:20px; right:20px; z-index:10000; display:flex; flex-direction:column; gap:8px;"></div>

</body>
</html>